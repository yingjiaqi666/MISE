<!-- 文件: templates/fragments/header.html -->
<header th:fragment="header">
    <nav class="navbar navbar-expand-lg header-gradient">
        <div class="container-fluid px-4">
            <!-- 左侧Logo - 靠最左 -->
            <a class="navbar-brand me-0" href="/">
                <span class="logo-text">STORY GAME</span>
            </a>

            <!-- 导航链接容器 - 均匀分布 -->
            <div class="navbar-nav mx-auto flex-row justify-content-between" style="width: 70%; max-width: 800px;">
                <a class="nav-link nav-link-purple" href="/">Home</a>
                <a class="nav-link nav-link-purple" href="/story-editor">Create Story</a>
                <a class="nav-link nav-link-purple" href="/scene-editor">Scene Editor</a>
                <a class="nav-link nav-link-purple" href="/profile">Profile</a>
                <a class="nav-link nav-link-purple" href="/my-stories">My Stories</a>
                <a class="nav-link nav-link-purple" href="/my-scenes">My Scenes</a>
                <!-- 修改AI助手按钮 - 去掉图标 -->
                <a class="nav-link nav-link-purple" href="/ai">Work with AI</a>
            </div>

            <!-- 右侧用户信息和登出按钮 - 靠最右 -->
            <div class="d-flex align-items-center ms-auto">
                <span class="welcome-text" id="header-username">Welcome,guest</span>
                <button class="btn btn-primary ms-3" onclick="handleLogout()">Logout</button>
            </div>
        </div>
    </nav>

    <!-- 添加Bootstrap图标 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">

    <script>
        // 页面加载时获取用户信息
        document.addEventListener('DOMContentLoaded', function() {
            fetch('/api/accounts/profile')
                .then(response => response.json())
                .then(result => {
                    if (result && result.code === '200' && result.data) {
                        document.getElementById('header-username').textContent = result.data.username;
                    }
                })
                .catch(error => {
                    console.log('Not logged in or error fetching profile');
                });
        });

        // 登出处理
        function handleLogout() {
            fetch('/logout', {
                method: 'POST',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' }
            })
                .then(response => {
                    window.location.href = '/login';
                })
                .catch(error => {
                    console.error('Logout error:', error);
                    window.location.href = '/login';
                });
        }
    </script>

    <style>
        /* 确保导航链接均匀分布 */
        .navbar-nav {
            flex: 1;
            justify-content: space-around !important;
        }

        /* 调整容器间距 */
        .navbar-brand.me-0 {
            margin-right: 0 !important;
        }

        /* 确保登出按钮靠最右 */
        .ms-auto {
            margin-left: auto !important;
        }

        /* 调整导航链接间距 */
        .nav-link {
            padding: 0.5rem 1rem !important;
            white-space: nowrap;
        }

        /* 响应式调整 */
        @media (max-width: 1200px) {
            .navbar-nav {
                width: 65% !important;
            }
        }

        @media (max-width: 992px) {
            .navbar-nav {
                width: 60% !important;
            }

            .nav-link {
                padding: 0.5rem 0.8rem !important;
                font-size: 0.95rem !important;
            }
        }

        @media (max-width: 768px) {
            .container-fluid.px-4 {
                padding-left: 1rem !important;
                padding-right: 1rem !important;
            }

            .navbar-nav {
                width: 100% !important;
                margin-top: 0.5rem;
                margin-bottom: 0.5rem;
                justify-content: flex-start !important;
                overflow-x: auto;
                flex-wrap: nowrap;
            }

            .nav-link {
                padding: 0.5rem 0.6rem !important;
                font-size: 0.9rem !important;
            }

            .welcome-text {
                display: none;
            }
        }
    </style>
</header>